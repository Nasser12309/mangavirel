<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØµÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        body {
            background-color: #390311;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            color: #fff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .top-bar {
            background-color: #982F1F;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .back-arrow-group {
            display: flex;
            gap: 10px;
            order: 1;
        }

        .back-arrow {
            font-size: 24px;
            color: #fff;
            cursor: pointer;
        }

        .button-container {
            display: flex;
            gap: 10px;
            order: 2;
        }

        .nav-button {
            background-color: transparent;
            color: #fff;
            border: 2px solid #fff;
            padding: 5px 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .nav-button:hover {
            background-color: rgba(255, 0, 0, 0.2);
        }
        .nav-button:disabled {
             opacity: 0.5;
             cursor: not-allowed;
        }

        .image-viewer-container {
            flex-grow: 1;
            margin: 0; 
            overflow-y: auto;
            background-color: #121212;
            padding: 0; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 300px;
        }

        .content-wrapper {
            text-align: center;
            width: 100%;
            max-width: 800px;
            padding: 0;
        }

        .chapter-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto; 
            /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ù„ØªØ¸Ù‡Ø± Ù…ØªÙ„Ø§ØµÙ‚Ø© */
            vertical-align: top;
        }

        .loading-indicator {
            color: #fff;
            padding: 20px;
            font-size: 16px;
            text-align: center;
        }

        .teil {
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .teil h3 {
            margin: 0;
            color: #fff;
            padding-top: 15px;
            font-size: 15px;
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ */
        .error-msg {
            color: #ff4444;
            background: #330000;
            padding: 15px;
            margin: 10px;
            border: 1px solid red;
            direction: ltr; /* Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ */
            text-align: left;
        }
    </style>
</head>
<body>

  <div class="top-bar">
    <div class="back-arrow-group">
        <i id="back-to-details" class="fas fa-arrow-right back-arrow"></i>
        <i id="home-button" class="fas fa-home back-arrow"></i>
          <div class="teil">
       <h3 id="chapter-title">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
    </div>
    </div>

    <div class="button-container">
        <button id="next-chapter-btn" class="nav-button">Ø§Ù„ÙØµÙ„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
        <button id="prev-chapter-btn" class="nav-button">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
    </div>
</div>

    <div id="image-viewer" class="image-viewer-container">
        <div id="content-wrapper" class="content-wrapper">
            </div>
        <div id="loading-status" class="loading-indicator"></div>
    </div>

<script>
    // 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function getProjectData(id) {
         // Ù‡Ù†Ø§ Ù†Ù‚ÙˆÙ… Ø¨ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙˆØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ø§
         const ALL_PROJECTS = {
            // Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
            'Nano-Machine': { title: 'Ù†Ø§Ù†Ùˆ Ù…Ø§Ø´ÙŠÙ†', totalChapters: 6, folderType: 'manhua' },
            'Demon-Slayer': { title: 'Ù‚Ø§ØªÙ„ Ø§Ù„Ø´ÙŠØ§Ø·ÙŠÙ†', totalChapters: 100, folderType: 'manga' },
            'One-Piece': { title: 'One Piece', totalChapters: 1100, folderType: 'manga' },
            'Reverend-insanity': { title: 'Reverend insanity', totalChapters: 50, folderType: 'manhua' },
            
            // === Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© ÙÙŠÙ†ÙˆÙ… Ù‡Ù†Ø§ ÙˆØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹Ù‡ ÙƒÙ€ comic ===
            'venom': { title: 'Venom', totalChapters: 6, folderType: 'comic' },
         };

         // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
         const data = ALL_PROJECTS[id] || {
             title: id ? id.replace(/-/g, ' ') : 'Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
             totalChapters: 200, 
             folderType: 'manhua' // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„
         };
         
         return data;
    }

    function getUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id') ? decodeURIComponent(urlParams.get('id')) : null;
        const chapterNumber = parseInt(urlParams.get('chapter'));
        return {
            id: id,
            chapter: !isNaN(chapterNumber) && chapterNumber > 0 ? chapterNumber : 1
        };
    }

    const { id: currentProjectId, chapter: currentChapterNumber } = getUrlParams();
    const projectData = getProjectData(currentProjectId);
    let currentChapterIndex = currentChapterNumber - 1;

    // Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const container = document.getElementById('content-wrapper');
    const loadingStatus = document.getElementById('loading-status');
    const chapterTitleElement = document.getElementById('chapter-title');
    const nextButton = document.getElementById('next-chapter-btn');
    const prevButton = document.getElementById('prev-chapter-btn');

    // ===============================================
    // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø°Ø±ÙŠ: Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ³Ù„Ø³Ù„ (Sequential Loading)
    // ===============================================
    
    function renderChapterImages() {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        updateChapterTitle();
        updateButtonState();
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
        container.innerHTML = '';
        loadingStatus.innerText = 'Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±...';

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        // === Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ù…Ù†Ø·Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ ===
        let baseDir;
        if (projectData.folderType === 'comic') {
            baseDir = 'Comic_Files';
        } else if (projectData.folderType === 'manga') {
            baseDir = 'Manga_Files';
        } else {
            baseDir = 'Manhua_Files'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        }
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø·Ø§Øª Ø§Ù„Ù…Ø§Ø¦Ù„Ø© Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        const cleanProjectId = currentProjectId ? currentProjectId.replace(/^\/|\/$/g, '') : '';
        
        // Ø§Ù„Ø¨Ø¯Ø¡ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø±Ù‚Ù… 1
        loadNextImage(1, baseDir, cleanProjectId);
    }

    function loadNextImage(index, baseDir, projectId) {
        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³Ø§Ø±
        const chapterFolder = `ch${currentChapterIndex + 1}`;
        const fileName = `img_${String(index).padStart(3, '0')}.webp`;
        
        // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const path = `${baseDir}/${projectId}/${chapterFolder}/${fileName}`;

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± ØµÙˆØ±Ø©
        const img = new Image();
        
        img.onload = function() {
            // âœ… Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„: Ø£Ø¶Ù Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ø·Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
            img.className = 'chapter-image';
            img.alt = `ØµÙØ­Ø© ${index}`;
            container.appendChild(img);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„
            loadingStatus.innerText = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${index} ØµÙˆØ±Ø©... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø²ÙŠØ¯`;
            
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù†ÙØ³Ù‡Ø§ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ
            loadNextImage(index + 1, baseDir, projectId);
        };

        img.onerror = function() {
            // ğŸ›‘ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ÙˆØµÙ„Ù†Ø§ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ Ø£Ùˆ Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø±
            if (index === 1) {
                // Ø¥Ø°Ø§ ÙØ´Ù„Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ÙÙ‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ø§Ù„Ù…Ø³Ø§Ø± Ø®Ø·Ø£)
                loadingStatus.innerHTML = '';
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-msg';
                errorDiv.innerHTML = `
                    <strong>âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±!</strong><br>
                    ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¶Ø§ÙØ© ØªØ·Ø§Ø¨Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± <strong>Ø­Ø±ÙÙŠØ§Ù‹</strong>:<br>
                    <br>
                    <code>${path}</code>
                `;
                container.appendChild(errorDiv);
            } else {
                // Ø¥Ø°Ø§ ÙØ´Ù„Øª ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„
                loadingStatus.innerText = '--- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØµÙ„ ---';
            }
        };

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØµØ¯Ø± Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        img.src = path;
    }

    // ===============================================
    // Ø¨Ù‚ÙŠØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù (Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±)
    // ===============================================

    function updateChapterTitle() {
        if (projectData) {
             const titleText = `${projectData.title} - Ø§Ù„ÙØµÙ„ ${currentChapterIndex + 1}`;
             chapterTitleElement.innerText = titleText;
             document.getElementById('page-title').innerText = titleText;
        }
    }

    function updateButtonState() {
        prevButton.disabled = (currentChapterIndex <= 0);
        nextButton.disabled = false; 
        
        const newUrl = `?id=${currentProjectId}&chapter=${currentChapterIndex + 1}`;
        window.history.replaceState({ path: newUrl }, '', newUrl);
    }

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
    document.getElementById('back-to-details').addEventListener('click', () => {
        window.location.href = `show_details.html?id=${currentProjectId}`;
    });
    document.getElementById('home-button').addEventListener('click', () => {
        window.location.href = 'index.html';
    });

    nextButton.addEventListener('click', () => {
        currentChapterIndex++;
        renderChapterImages();
    });

    prevButton.addEventListener('click', () => {
        if (currentChapterIndex > 0) {
            currentChapterIndex--;
            renderChapterImages();
        }
    });

    // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    renderChapterImages();

</script>

</body>
</html>
